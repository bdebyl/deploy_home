geo $whitelisted {
  default 0;
  192.168.1.0/24 1;
}

upstream partkeepr {
  server localhost:8081;
}

server {
  listen 80;
  server_name {{ parts_server_name }};

  if ($whitelisted = 0) {
    return 302 $scheme://bdebyl.net$request_uri;
  }

  location / {
    proxy_pass http://partkeepr;
    proxy_connect_timeout 1s;
  }
}
