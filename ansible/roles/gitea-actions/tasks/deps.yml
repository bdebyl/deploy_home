---
- name: install podman-docker for docker CLI compatibility
  become: true
  ansible.builtin.dnf:
    name:
      - podman-docker
      - golang
    state: present
  tags: gitea-actions

- name: create podman socket override directory
  become: true
  ansible.builtin.file:
    path: /etc/systemd/system/podman.socket.d
    state: directory
    mode: "0755"
  tags: gitea-actions

- name: configure podman socket for gitea-runner access
  become: true
  ansible.builtin.copy:
    dest: /etc/systemd/system/podman.socket.d/override.conf
    content: |
      [Socket]
      SocketMode=0660
      SocketGroup={{ gitea_runner_user }}
    mode: "0644"
  notify: restart podman socket
  tags: gitea-actions

- name: enable system podman socket
  become: true
  ansible.builtin.systemd:
    name: podman.socket
    daemon_reload: true
    enabled: true
    state: started
  tags: gitea-actions
